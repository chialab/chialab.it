{
  "family": "manager-chialab",
  "taskRoleArn": "TODO",
  "executionRoleArn": "TODO",
  "requiresCompatibilities": ["EC2"],
  "networkMode": "bridge",
  "containerDefinitions": [
    {
      "name": "app",
      "image": "${ECR_MANAGER_APP}:${IMAGE_TAG}",
      "essential": true,
      "memory": 128,
      "environment": [
        {"name": "DEBUG", "value": "0"},
        {"name": "APP_DEFAULT_LOCALE", "value": "it_IT"},
        {"name": "APP_DEFAULT_TIMEZONE", "value": "Europe/Rome"},
        {"name": "CACHE_REDIS_HOST", "value": "prod-redis.dreamteam.local"},
        {"name": "BEDITA_API", "value": "https://api.chialab.it"}
      ],
      "secrets": [
        {"name": "SECURITY_SALT", "valueFrom": "TODO"},
        {"name": "BEDITA_API_KEY", "valueFrom": "TODO"}
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/${ECS_CLUSTER}",
          "awslogs-region": "${AWS_DEFAULT_REGION}",
          "awslogs-stream-prefix": "prod/manager/chialab",
          "awslogs-multiline-pattern": "^(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3} - |\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2} |\\[[\\d ]?\\d-\\w{3}-\\d{4} \\d{2}:\\d{2}:\\d{2}\\] )"
        }
      }
    },
    {
      "name": "web",
      "image": "${ECR_MANAGER_WEB}:${IMAGE_TAG}",
      "essential": true,
      "memory": 64,
      "environment": [
        {"name": "PHPFPM_HOST", "value": "app:9000"}
      ],
      "portMappings": [
        {
          "containerPort": 443,
          "hostPort": 0,
          "protocol": "tcp"
        }
      ],
      "links": ["app"],
      "healthCheck": {
        "retries": 3,
        "command": ["CMD", "wget", "-qO-", "http://localhost/status"],
        "timeout": 5,
        "interval": 5
      },
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/${ECS_CLUSTER}",
          "awslogs-region": "${AWS_DEFAULT_REGION}",
          "awslogs-stream-prefix": "prod/manager/chialab"
        }
      }
    }
  ]
}
